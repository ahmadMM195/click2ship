{% extends "click2ship_core/templates/layout.html" %}

{% block content %}
<div id="cached-bookings"></div>
<div id="rec-name"></div>



<section id="cover">
    <div class="container">
        <div class="quote-header"><h2>Book Your Delivery</h2></div>
    </div>
    <div class="container">
        <!-- Shipper Address -->
        <div class="row">
            <div class="col-md-6">
                <div class="identity-section signin-section">
                    <div class="identity-head">
                        <h4>Sign In</h4>
                        <p>Sign In to use saved payment methods and add this order to your account.</p>
                    </div>
                    <form id="loginForm" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrfToken }}">
                        {% for field,type,label in [
                            ('usr','text','Email'),
                            ('pwd','password','Password')
                        ] %}
                        <div class="form-group mb-4">
                            <div class="form-floating">
                                <input name="{{ field }}" type="{{ type }}" class="form-control">
                                <label>{{ label }}</label>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <button type="submit" class="nav-btn -outlined">
                            <svg class="mr-2 w-7 h-7 -mt-1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M11.25 19a.75.75 0 0 1 .75-.75h6a.25.25 0 0 0 .25-.25V6a.25.25 0 0 0-.25-.25h-6a.75.75 0 0 1 0-1.5h6c.966 0 1.75.784 1.75 1.75v12A1.75 1.75 0 0 1 18 19.75h-6a.75.75 0 0 1-.75-.75"></path>
                                <path fill="currentColor" d="M3.5 13.115a1 1 0 0 0 1 1h4.856c.023.356.052.71.086 1.066l.03.305a.718.718 0 0 0 1.025.578a16.844 16.844 0 0 0 4.884-3.539l.03-.031a.721.721 0 0 0 0-.998l-.03-.031a16.842 16.842 0 0 0-4.884-3.539a.718.718 0 0 0-1.025.578l-.03.305c-.034.355-.063.71-.086 1.066H4.5a1 1 0 0 0-1 1z"></path>
                            </svg>
                            <span>Sign In</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Delivery Address -->
            <div class="col-md-6">
                <div class="identity-section guest-section">
                    <div class="identity-head">
                        <h4>Guest Checkout</h4>
                        <p>We just need your email to send you the order confirmation & labels.</p>
                    </div>
                    <form id="guestForm" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrfToken }}">
                        {% for field,type,label in [
                            ('Email','text','Email'),
                        ] %}
                        <div class="form-group mb-4">
                            <div class="form-floating">
                                <input name="{{ field }}" type="{{ type }}" class="form-control">
                                <label>{{ label }}</label>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <button type="submit" class="nav-btn -outlined">
                            <svg class="mr-2 w-7 h-7 -mt-1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M11.25 19a.75.75 0 0 1 .75-.75h6a.25.25 0 0 0 .25-.25V6a.25.25 0 0 0-.25-.25h-6a.75.75 0 0 1 0-1.5h6c.966 0 1.75.784 1.75 1.75v12A1.75 1.75 0 0 1 18 19.75h-6a.75.75 0 0 1-.75-.75"></path>
                                <path fill="currentColor" d="M3.5 13.115a1 1 0 0 0 1 1h4.856c.023.356.052.71.086 1.066l.03.305a.718.718 0 0 0 1.025.578a16.844 16.844 0 0 0 4.884-3.539l.03-.031a.721.721 0 0 0 0-.998l-.03-.031a16.842 16.842 0 0 0-4.884-3.539a.718.718 0 0 0-1.025.578l-.03.305c-.034.355-.063.71-.086 1.066H4.5a1 1 0 0 0-1 1z"></path>
                            </svg>
                            <span>Pay Now</span>
                        </button>
                        <div class="payment-methods">
                            <svg xmlns="http://www.w3.org/2000/svg" width="3.09em" height="1em" viewBox="0 0 256 83">
                                <defs>
                                    <linearGradient id="logosVisa0" x1="45.974%" x2="54.877%" y1="-2.006%" y2="100%">
                                        <stop offset="0%" stop-color="#222357"></stop>
                                        <stop offset="100%" stop-color="#254aa5"></stop>
                                    </linearGradient>
                                </defs>
                                <path fill="url(#logosVisa0)" d="M132.397 56.24c-.146-11.516 10.263-17.942 18.104-21.763c8.056-3.92 10.762-6.434 10.73-9.94c-.06-5.365-6.426-7.733-12.383-7.825c-10.393-.161-16.436 2.806-21.24 5.05l-3.744-17.519c4.82-2.221 13.745-4.158 23-4.243c21.725 0 35.938 10.724 36.015 27.351c.085 21.102-29.188 22.27-28.988 31.702c.069 2.86 2.798 5.912 8.778 6.688c2.96.392 11.131.692 20.395-3.574l3.636 16.95c-4.982 1.814-11.385 3.551-19.357 3.551c-20.448 0-34.83-10.87-34.946-26.428m89.241 24.968c-3.967 0-7.31-2.314-8.802-5.865L181.803 1.245h21.709l4.32 11.939h26.528l2.506-11.939H256l-16.697 79.963zm3.037-21.601l6.265-30.027h-17.158zm-118.599 21.6L88.964 1.246h20.687l17.104 79.963zm-30.603 0L53.941 26.782l-8.71 46.277c-1.022 5.166-5.058 8.149-9.54 8.149H.493L0 78.886c7.226-1.568 15.436-4.097 20.41-6.803c3.044-1.653 3.912-3.098 4.912-7.026L41.819 1.245H63.68l33.516 79.963z" transform="matrix(1 0 0 -1 0 82.668)"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.29em" height="1em" viewBox="0 0 256 199">
                                <path d="M46.54 198.011V184.84c0-5.05-3.074-8.342-8.343-8.342c-2.634 0-5.488.878-7.464 3.732c-1.536-2.415-3.731-3.732-7.024-3.732c-2.196 0-4.39.658-6.147 3.073v-2.634h-4.61v21.074h4.61v-11.635c0-3.731 1.976-5.488 5.05-5.488c3.072 0 4.61 1.976 4.61 5.488v11.635h4.61v-11.635c0-3.731 2.194-5.488 5.048-5.488c3.074 0 4.61 1.976 4.61 5.488v11.635zm68.271-21.074h-7.463v-6.366h-4.61v6.366h-4.171v4.17h4.17v9.66c0 4.83 1.976 7.683 7.245 7.683c1.976 0 4.17-.658 5.708-1.536l-1.318-3.952c-1.317.878-2.853 1.098-3.951 1.098c-2.195 0-3.073-1.317-3.073-3.513v-9.44h7.463zm39.076-.44c-2.634 0-4.39 1.318-5.488 3.074v-2.634h-4.61v21.074h4.61v-11.854c0-3.512 1.536-5.488 4.39-5.488c.878 0 1.976.22 2.854.439l1.317-4.39c-.878-.22-2.195-.22-3.073-.22m-59.052 2.196c-2.196-1.537-5.269-2.195-8.562-2.195c-5.268 0-8.78 2.634-8.78 6.805c0 3.513 2.634 5.488 7.244 6.147l2.195.22c2.415.438 3.732 1.097 3.732 2.195c0 1.536-1.756 2.634-4.83 2.634c-3.073 0-5.488-1.098-7.025-2.195l-2.195 3.512c2.415 1.756 5.708 2.634 9 2.634c6.147 0 9.66-2.853 9.66-6.805c0-3.732-2.854-5.708-7.245-6.366l-2.195-.22c-1.976-.22-3.512-.658-3.512-1.975c0-1.537 1.536-2.415 3.951-2.415c2.635 0 5.269 1.097 6.586 1.756zm122.495-2.195c-2.635 0-4.391 1.317-5.489 3.073v-2.634h-4.61v21.074h4.61v-11.854c0-3.512 1.537-5.488 4.39-5.488c.879 0 1.977.22 2.855.439l1.317-4.39c-.878-.22-2.195-.22-3.073-.22m-58.833 10.976c0 6.366 4.39 10.976 11.196 10.976c3.073 0 5.268-.658 7.463-2.414l-2.195-3.732c-1.756 1.317-3.512 1.975-5.488 1.975c-3.732 0-6.366-2.634-6.366-6.805c0-3.951 2.634-6.586 6.366-6.805c1.976 0 3.732.658 5.488 1.976l2.195-3.732c-2.195-1.757-4.39-2.415-7.463-2.415c-6.806 0-11.196 4.61-11.196 10.976m42.588 0v-10.537h-4.61v2.634c-1.537-1.975-3.732-3.073-6.586-3.073c-5.927 0-10.537 4.61-10.537 10.976c0 6.366 4.61 10.976 10.537 10.976c3.073 0 5.269-1.097 6.586-3.073v2.634h4.61zm-16.904 0c0-3.732 2.415-6.805 6.366-6.805c3.732 0 6.367 2.854 6.367 6.805c0 3.732-2.635 6.805-6.367 6.805c-3.951-.22-6.366-3.073-6.366-6.805m-55.1-10.976c-6.147 0-10.538 4.39-10.538 10.976c0 6.586 4.39 10.976 10.757 10.976c3.073 0 6.147-.878 8.562-2.853l-2.196-3.293c-1.756 1.317-3.951 2.195-6.146 2.195c-2.854 0-5.708-1.317-6.367-5.05h15.587v-1.755c.22-6.806-3.732-11.196-9.66-11.196m0 3.951c2.853 0 4.83 1.757 5.268 5.05h-10.976c.439-2.854 2.415-5.05 5.708-5.05m114.372 7.025v-18.879h-4.61v10.976c-1.537-1.975-3.732-3.073-6.586-3.073c-5.927 0-10.537 4.61-10.537 10.976c0 6.366 4.61 10.976 10.537 10.976c3.074 0 5.269-1.097 6.586-3.073v2.634h4.61zm-16.903 0c0-3.732 2.414-6.805 6.366-6.805c3.732 0 6.366 2.854 6.366 6.805c0 3.732-2.634 6.805-6.366 6.805c-3.952-.22-6.366-3.073-6.366-6.805m-154.107 0v-10.537h-4.61v2.634c-1.537-1.975-3.732-3.073-6.586-3.073c-5.927 0-10.537 4.61-10.537 10.976c0 6.366 4.61 10.976 10.537 10.976c3.074 0 5.269-1.097 6.586-3.073v2.634h4.61zm-17.123 0c0-3.732 2.415-6.805 6.366-6.805c3.732 0 6.367 2.854 6.367 6.805c0 3.732-2.635 6.805-6.367 6.805c-3.951-.22-6.366-3.073-6.366-6.805"></path>
                                <path fill="#ff5f00" d="M93.298 16.903h69.15v124.251h-69.15z"></path>
                                <path fill="#eb001b" d="M97.689 79.029c0-25.245 11.854-47.637 30.074-62.126C114.373 6.366 97.47 0 79.03 0C35.343 0 0 35.343 0 79.029c0 43.685 35.343 79.029 79.029 79.029c18.44 0 35.343-6.366 48.734-16.904c-18.22-14.269-30.074-36.88-30.074-62.125"></path>
                                <path fill="#f79e1b" d="M255.746 79.029c0 43.685-35.343 79.029-79.029 79.029c-18.44 0-35.343-6.366-48.734-16.904c18.44-14.488 30.075-36.88 30.075-62.125c0-25.245-11.855-47.637-30.075-62.126C141.373 6.366 158.277 0 176.717 0c43.686 0 79.03 35.563 79.03 79.029"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1em" viewBox="0 0 2304 1536">
                                <path fill="#2671b9" d="M119 554h89l-45-108zm621 526l74-79l-70-79H581v49h142v55H581v54zm158-78l99 110V895zm288-47q0-33-40-33h-84v69h83q41 0 41-36m289-4q0-29-42-29h-82v61h81q43 0 43-32m-278-466q0-29-42-29h-82v60h81q43 0 43-31m459 69h89l-44-108zM699 399v271h-66V458l-94 212h-57l-94-212v212H256l-25-60H96l-25 60H1l116-271h96l110 257V399h106l85 184l77-184zm556 556q0 20-5.5 35t-14 25t-22.5 16.5t-26 10t-31.5 4.5t-31.5 1t-32.5-.5t-29.5-.5v91H936l-80-90l-83 90H517V866h260l80 89l82-89h207q109 0 109 89M964 614v56H747V399h217v57H812v49h148v55H812v54zm1340 559v229q0 55-38.5 94.5T2172 1536H132q-55 0-93.5-39.5T0 1402V724h111l25-61h55l25 61h218v-46l19 46h113l20-47v47h541v-99l10-1q10 0 10 14v86h279v-23q23 12 55 18t52.5 6.5t63-.5t51.5-1l25-61h56l25 61h227v-58l34 58h182V346h-180v44l-25-44h-185v44l-23-44h-249q-69 0-109 22v-22h-172v22q-24-22-73-22H553l-43 97l-43-97H269v44l-22-44H78L0 525V134q0-55 38.5-94.5T132 0h2040q55 0 93.5 39.5T2304 134v678h-120q-51 0-81 22v-22h-177q-55 0-78 22v-22h-316v22q-31-22-87-22h-209v22q-23-22-91-22H911l-54 58l-50-58H458v378h343l55-59l52 59h211v-89h21q59 0 90-13v102h174v-99h8q8 0 10 2t2 10v87h529q57 0 88-24v24h168q60 0 95-17m-758-234q0 23-12 43t-34 29q25 9 34 26t9 46v54h-65v-45q0-33-12-43.5t-46-10.5h-69v99h-65V866h154q48 0 77 15t29 58m-277-467q0 24-12.5 44t-33.5 29q26 9 34.5 25.5t8.5 46.5v53h-65q0-9 .5-26.5t0-25t-3-18.5t-8.5-16t-17.5-8.5t-29.5-3.5h-70v98h-64V399l153 1q49 0 78 14.5t29 57.5m529 609v56h-216V866h216v56h-151v49h148v55h-148v54zm-426-682v271h-66V399zm693 652q0 86-102 86h-126v-58h126q34 0 34-25q0-16-17-21t-41.5-5t-49.5-3.5t-42-22.5t-17-55q0-39 26-60t66-21h130v57h-119q-36 0-36 25q0 16 17.5 20.5t42 4t49 2.5t42 21.5t17.5 54.5m239-50v101q-24 35-88 35h-125v-58h125q33 0 33-25q0-13-12.5-19t-31-5.5t-40-2t-40-8t-31-24T2082 947q0-39 26.5-60t66.5-21h129v57h-118q-36 0-36 25q0 20 29 22t68.5 5t56.5 26m-165-601v270h-92l-122-203v203h-132l-26-60h-134l-25 60h-75q-129 0-129-133q0-138 133-138h63v59q-7 0-28-1t-28.5-.5t-23 2t-21.5 6.5t-14.5 13.5t-11.5 23t-3 33.5q0 38 13.5 58t49.5 20h29l92-213h97l109 256V400h99l114 188V400z"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="0.85em" height="1em" viewBox="0 0 256 302">
                                <path fill="#27346a" d="M217.168 23.507C203.234 7.625 178.046.816 145.823.816h-93.52A13.393 13.393 0 0 0 39.076 12.11L.136 259.077c-.774 4.87 2.997 9.28 7.933 9.28h57.736l14.5-91.971l-.45 2.88c1.033-6.501 6.593-11.296 13.177-11.296h27.436c53.898 0 96.101-21.892 108.429-85.221c.366-1.873.683-3.696.957-5.477c-1.556-.824-1.556-.824 0 0c3.671-23.407-.025-39.34-12.686-53.765"></path>
                                <path fill="#27346a" d="M102.397 68.84a11.737 11.737 0 0 1 5.053-1.14h73.318c8.682 0 16.78.565 24.18 1.756a101.6 101.6 0 0 1 6.177 1.182a89.928 89.928 0 0 1 8.59 2.347c3.638 1.215 7.026 2.63 10.14 4.287c3.67-23.416-.026-39.34-12.687-53.765C203.226 7.625 178.046.816 145.823.816H52.295C45.71.816 40.108 5.61 39.076 12.11L.136 259.068c-.774 4.878 2.997 9.282 7.925 9.282h57.744L95.888 77.58a11.717 11.717 0 0 1 6.509-8.74"></path>
                                <path fill="#2790c3" d="M228.897 82.749c-12.328 63.32-54.53 85.221-108.429 85.221H93.024c-6.584 0-12.145 4.795-13.168 11.296L61.817 293.621c-.674 4.262 2.622 8.124 6.934 8.124h48.67a11.71 11.71 0 0 0 11.563-9.88l.474-2.48l9.173-58.136l.591-3.213a11.71 11.71 0 0 1 11.562-9.88h7.284c47.147 0 84.064-19.154 94.852-74.55c4.503-23.15 2.173-42.478-9.739-56.054c-3.613-4.112-8.1-7.508-13.327-10.28c-.283 1.79-.59 3.604-.957 5.477"></path>
                                <path fill="#1f264f" d="M216.952 72.128a89.928 89.928 0 0 0-5.818-1.49a109.904 109.904 0 0 0-6.177-1.174c-7.408-1.199-15.5-1.765-24.19-1.765h-73.309a11.57 11.57 0 0 0-5.053 1.149a11.683 11.683 0 0 0-6.51 8.74l-15.582 98.798l-.45 2.88c1.025-6.501 6.585-11.296 13.17-11.296h27.444c53.898 0 96.1-21.892 108.428-85.221c.367-1.873.675-3.688.958-5.477c-3.122-1.648-6.501-3.072-10.14-4.279a83.26 83.26 0 0 0-2.77-.865"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="2.51em" height="1em" viewBox="0 0 512 204">
                                <path fill="#5f6368" d="M362.927 55.057c14.075 0 24.952 3.839 33.27 11.517c8.317 7.677 12.155 17.914 12.155 30.71v61.42h-17.914V144.63h-.64c-7.677 11.517-18.554 17.275-31.35 17.275c-10.877 0-20.474-3.2-28.151-9.597c-7.038-6.398-11.517-15.355-11.517-24.952c0-10.237 3.84-18.555 11.517-24.953s18.554-8.957 31.35-8.957c11.516 0 20.474 1.92 27.511 6.398v-4.478c0-5.972-2.229-11.943-6.688-15.834l-.99-.801c-5.118-4.479-11.516-7.038-18.553-7.038c-10.877 0-19.194 4.479-24.953 13.436L321.34 74.89c10.236-13.436 23.672-19.834 41.587-19.834M272.715 11.55c11.48 0 22.39 3.995 31.113 11.445l1.517 1.35c8.957 7.678 13.435 19.195 13.435 31.351c0 12.156-4.478 23.033-13.435 31.35c-8.958 8.318-19.834 12.796-32.63 12.796l-30.71-.64v59.502H222.81V11.55zm92.77 97.25c-7.677 0-14.075 1.919-19.193 5.758c-5.119 3.199-7.678 7.677-7.678 13.435c0 5.119 2.56 9.597 6.398 12.157c4.479 3.199 9.597 5.118 14.716 5.118c7.165 0 14.331-2.787 19.936-7.84l1.177-1.117c6.398-5.758 9.597-12.796 9.597-20.474c-5.758-4.478-14.076-7.038-24.952-7.038m-91.49-79.336h-31.99V80.65h31.99c7.037 0 14.075-2.559 18.554-7.677c10.236-9.597 10.236-25.592.64-35.19l-.64-.64c-5.119-5.118-11.517-8.317-18.555-7.677M512 58.256l-63.34 145.235h-19.194l23.672-50.544l-41.587-94.051h20.474l30.07 72.297h.64l29.431-72.297H512z"></path>
                                <path fill="#4285f4" d="M165.868 86.407c0-5.758-.64-11.516-1.28-17.274H84.615v32.63h45.425c-1.919 10.236-7.677 19.833-16.634 25.592v21.113h27.511c15.995-14.715 24.952-36.469 24.952-62.06"></path>
                                <path fill="#34a853" d="M84.614 168.942c23.032 0 42.226-7.678 56.302-20.474l-27.511-21.113c-7.678 5.118-17.275 8.317-28.791 8.317c-21.754 0-40.948-14.715-47.346-35.189H9.118v21.753c14.715 28.791 43.506 46.706 75.496 46.706"></path>
                                <path fill="#fbbc04" d="M37.268 100.483c-3.838-10.237-3.838-21.753 0-32.63V46.1H9.118c-12.157 23.673-12.157 51.824 0 76.136z"></path>
                                <path fill="#ea4335" d="M84.614 33.304c12.156 0 23.672 4.479 32.63 12.796l24.312-24.312C126.2 7.712 105.727-.605 85.253.034c-31.99 0-61.42 17.915-75.496 46.706l28.151 21.753c5.758-20.474 24.952-35.189 46.706-35.189"></path>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="2.43em" height="1em" viewBox="0 0 512 211">
                                <path d="M93.552 27.103c-6 7.1-15.602 12.702-25.203 11.901c-1.2-9.6 3.5-19.802 9.001-26.103C83.35 5.601 93.852.4 102.353 0c1 10.001-2.9 19.802-8.8 27.103m8.701 13.802c-13.902-.8-25.803 7.9-32.404 7.9c-6.7 0-16.802-7.5-27.803-7.3c-14.301.2-27.603 8.3-34.904 21.202c-15.002 25.803-3.9 64.008 10.601 85.01c7.101 10.401 15.602 21.802 26.803 21.402c10.602-.4 14.802-6.9 27.604-6.9c12.901 0 16.602 6.9 27.803 6.7c11.601-.2 18.902-10.4 26.003-20.802c8.1-11.801 11.401-23.303 11.601-23.903c-.2-.2-22.402-8.7-22.602-34.304c-.2-21.402 17.502-31.603 18.302-32.203c-10.002-14.802-25.603-16.402-31.004-16.802m80.31-29.004V167.82h24.202v-53.306h33.504c30.603 0 52.106-21.002 52.106-51.406c0-30.403-21.103-51.206-51.306-51.206zm24.202 20.403h27.903c21.003 0 33.004 11.201 33.004 30.903c0 19.702-12.001 31.004-33.104 31.004h-27.803zM336.58 169.019c15.202 0 29.303-7.7 35.704-19.902h.5v18.702h22.403V90.21c0-22.502-18.002-37.004-45.706-37.004c-25.703 0-44.705 14.702-45.405 34.904h21.803c1.8-9.601 10.7-15.902 22.902-15.902c14.802 0 23.103 6.901 23.103 19.603v8.6l-30.204 1.8c-28.103 1.7-43.304 13.202-43.304 33.205c0 20.202 15.701 33.603 38.204 33.603m6.5-18.502c-12.9 0-21.102-6.2-21.102-15.702c0-9.8 7.901-15.501 23.003-16.401l26.903-1.7v8.8c0 14.602-12.401 25.003-28.803 25.003m82.01 59.707c23.603 0 34.704-9 44.405-36.304L512 54.706h-24.603l-28.503 92.11h-.5l-28.503-92.11h-25.303l41.004 113.513l-2.2 6.901c-3.7 11.701-9.701 16.202-20.402 16.202c-1.9 0-5.6-.2-7.101-.4v18.702c1.4.4 7.4.6 9.201.6"></path>
                            </svg>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
document.addEventListener("DOMContentLoaded", function() {
fetch("/api/method/click2ship_core.api.call.session_data", {
        credentials: "include"
    })
    .then(res => res.json())
    .then(result => {

         const container = document.getElementById("cached-bookings");

            if(result.message){
                const data = result.message;
                if(Object.keys(data).length === 0){
                    container.innerHTML = "<p>No booking data in cache.</p>";
                } else {
                    var recipientName = data?.data?.booking?.shipper?.person_name || data?.data?.booking?.Shipper?.ContactName ||"";
                    console.log("^^",recipientName);
                    
                    $("#rec-name").html(recipientName)
                    // container.innerHTML = recipientName;

                    container.innerHTML = "<pre>" + JSON.stringify(data, null, 4) + "</pre>";
                }
            }
});
});

    

/* LOGIN FORM */
document.querySelector("#loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const csrfToken = "{{ csrf_token }}"; 
    let form = e.target;
    let data = new FormData(form);
    for (let [k, v] of data.entries()) console.log(k, v); // debug

    try {
        let res = await fetch("/api/method/login", {
            method: "POST",
            body: data
        });

        let result = await res.json();
        if (result.message === "Logged In") {
            // ✅ redirect user to cart page
            window.location.href = "/cart";
        } else {
            document.querySelector("#loginError").innerText = result.message || "Invalid credentials";
        }
    } catch (err) {
        document.querySelector("#loginError").innerText = "Something went wrong. Please try again.";
    }
});

/* GUEST CHECKOUT FORM */
/* GUEST CHECKOUT FORM */
document.querySelector("#guestForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    let form = e.target;
    let data = new FormData(form);
    console.log("--",data);
    
    // data['rec_name'] =    $("#rec-name").html()
    data.append('rec_name', $("#rec-name").html());


    try {
        let res = await fetch("/api/method/click2ship_core.api.identity_api.guest_checkout", {
            method: "POST",
            body: data,
            credentials: "include"
        });

        let result = await res.json();
        console.log("Guest Checkout Result:", result);

        // ✅ If logged in, go through login page with redirect-to
        if (
            result.message &&
            (result.message.message === "Logged In" || result.message.message === "Already Logged In")
        ) {
            console.log("imhere")
            window.location.href = "/cart";
        } else {
            document.querySelector("#guestError").innerText =
                (result.message && result.message.message) || "Guest checkout failed";
        }
    } catch (err) {
        console.error("Guest Checkout Error:", err);
        document.querySelector("#guestError").innerText = "Something went wrong. Please try again.";
    }
});


</script>
{% endblock %}
